{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h2 class="text-center mb-4">Polynomial Curve Fitting</h2>
    <form method="POST" class="border p-4 rounded bg-light">
        <!-- Number of Data Points -->
        <div class="mb-3">
            <label for="num_points" class="form-label">Number of Data Points:</label>
            <select id="num_points" name="num_points" class="form-select">
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4" selected>4</option>
                <option value="5">5</option>
                <option value="6">6</option>
            </select>
        </div>

        <!-- Dynamic Input Fields -->
        <div id="data_input">
            <h4>Data Points:</h4>
            <table class="table table-bordered">
                {% for i in range(4) %}
                <tr>
                    <td>
                        <input type="number" step="any" name="x_{{i}}" placeholder="x[{{i}}]" class="form-control">
                    </td>
                    <td>
                        <input type="number" step="any" name="y_{{i}}" placeholder="y[{{i}}]" class="form-control">
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>

        <!-- Polynomial Degree -->
        <div class="mb-3">
            <label for="degree" class="form-label">Polynomial Degree:</label>
            <input type="number" id="degree" name="degree" value="3" min="1" class="form-control" required>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary w-100">Fit Polynomial</button>
    </form>

    <!-- Results Section -->
    {% if result %}
    <div class="mt-4">
        <h3>Results:</h3>
        <p><strong>Fitted Polynomial Equation:</strong> {{ result.equation }}</p>
        <img src="data:image/png;base64,{{ result.plot_image }}" alt="Polynomial Fit Plot" class="img-fluid">
        <p><strong>Description:</strong> The red curve represents the fitted polynomial equation.
            The blue dots are the original data points provided by the user.</p>
    </div>
    {% endif %}

    <!-- Error Section -->
    {% if error %}
    <div class="mt-4">
        <h3>Error:</h3>
        <p class="alert alert-danger">{{ error }}</p>
    </div>
    {% endif %}
</div>

<!-- JavaScript Code -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    const numPointsSelector = document.getElementById('num_points');
    const dataInputDiv = document.getElementById('data_input');

    // Function to dynamically update input fields
    function updateInputs(numPoints) {
        // Clear previous inputs
        dataInputDiv.innerHTML = '';

        // Create a new table for the inputs
        const table = document.createElement('table');
        table.classList.add('table', 'table-bordered');
        for (let i = 0; i < numPoints; i++) {
            const row = document.createElement('tr');

            // Create x input
            const xCell = document.createElement('td');
            const xInput = document.createElement('input');
            xInput.type = 'number';
            xInput.step = 'any';
            xInput.name = `x_${i}`;
            xInput.placeholder = `x[${i}]`;
            xInput.classList.add('form-control');
            xCell.appendChild(xInput);
            row.appendChild(xCell);

            // Create y input
            const yCell = document.createElement('td');
            const yInput = document.createElement('input');
            yInput.type = 'number';
            yInput.step = 'any';
            yInput.name = `y_${i}`;
            yInput.placeholder = `y[${i}]`;
            yInput.classList.add('form-control');
            yCell.appendChild(yInput);
            row.appendChild(yCell);

            table.appendChild(row);
        }
        dataInputDiv.appendChild(table);
    }

    // Initial call to set up inputs for default number of points
    updateInputs(parseInt(numPointsSelector.value));

    // Add event listener for number of points change
    numPointsSelector.addEventListener('change', function () {
        const numPoints = parseInt(this.value);
        updateInputs(numPoints);
    });
});
</script>
{% endblock %}